{"version":3,"file":"index.js","sourceRoot":"","sources":["index.tsx"],"names":[],"mappings":"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","sourcesContent":["import { render, h, Fragment } from \"preact\";\nimport ValueInspector from \"./ValueInspector\";\nimport * as styles from \"./styles\";\nimport { useState, useSyncExternalStore } from \"preact/compat\";\nimport { useEffect } from \"react\";\n\nconst root = document.createElement(\"div\");\n\nroot.style.position = \"fixed\";\nroot.style.zIndex = \"99999999999999999999\";\nroot.style.top = \"0px\";\nroot.style.right = \"0px\";\n\ntype CodeLocation = {\n  name: string;\n  path: string;\n};\n\ntype ObserverType = \"component\" | \"effect\" | \"derived\";\n\ntype Observer = CodeLocation & {\n  type: ObserverType;\n};\n\ntype DebugData =\n  | {\n      type: \"signal\";\n      source: CodeLocation;\n      target: CodeLocation;\n      observers: Observer[];\n      value: any;\n    }\n  | {\n      type: \"derived\";\n    }\n  | {\n      type: \"effect\";\n    };\n\nlet currentDebugData: DebugData[] = [];\n\nlet currentSubscriber: undefined | ((data: DebugData[]) => void);\n\nexport function addDebugData(data: DebugData) {\n  currentDebugData = [data, ...currentDebugData];\n  currentSubscriber?.(currentDebugData);\n}\n\nfunction useWorkspacePath() {\n  const [workspacePath, setWorkspacePath] = useState(\n    localStorage.getItem(\"impact.debugger.workspacePath\") || \"\",\n  );\n\n  useEffect(() => {\n    if (workspacePath) {\n      localStorage.setItem(\"impact.debugger.workspacePath\", workspacePath);\n    }\n  }, [workspacePath]);\n\n  return [workspacePath, setWorkspacePath] as const;\n}\n\nfunction CodeReference({\n  name,\n  path,\n  workspacePath,\n  type,\n}: CodeLocation & { type?: ObserverType; workspacePath: string }) {\n  return (\n    <span className=\"impact-debugger-tooltip\">\n      <span className={styles.tooltip}>{path}</span>\n      <a\n        href={\n          \"vscode://file/\" +\n          (workspacePath.startsWith(\"/\")\n            ? workspacePath.substring(1)\n            : workspacePath) +\n          path\n        }\n        className={styles.itemLink}\n        style={\n          type\n            ? {\n                color:\n                  type === \"component\"\n                    ? styles.colors.blue\n                    : type === \"effect\"\n                    ? styles.colors.purple\n                    : styles.colors.green,\n              }\n            : undefined\n        }\n      >\n        {name}\n      </a>\n    </span>\n  );\n}\n\nfunction Item({\n  data,\n  workspacePath,\n}: {\n  data: DebugData;\n  workspacePath: string;\n}) {\n  let content;\n  if (data.type === \"signal\") {\n    const observers = data.observers.slice();\n    const lastObserver = observers.pop();\n\n    content = (\n      <Fragment>\n        <div>\n          <span className={styles.circle}>{data.observers.length}</span>\n        </div>\n        <div className={styles.itemContent}>\n          <div className={styles.itemTextContent}>\n            Signal changed in{\" \"}\n            <CodeReference\n              workspacePath={workspacePath}\n              name={data.target.name}\n              path={data.target.path}\n            />{\" \"}\n            with the value{\" \"}\n            <span className={styles.itemValue}>\n              <ValueInspector delimiter=\".\" value={data.value} />\n            </span>\n            . Called from{\" \"}\n            <CodeReference\n              workspacePath={workspacePath}\n              name={data.source.name}\n              path={data.source.path}\n            />\n            . Observed by{\" \"}\n            {observers.length ? (\n              <>\n                {observers.map((observer, index) => (\n                  <>\n                    <CodeReference\n                      key={index}\n                      workspacePath={workspacePath}\n                      {...observer}\n                    />\n                    {index === observers.length - 1 ? \" \" : \", \"}\n                  </>\n                ))}{\" \"}\n                and{\" \"}\n              </>\n            ) : null}\n            {lastObserver ? (\n              <CodeReference workspacePath={workspacePath} {...lastObserver} />\n            ) : null}\n          </div>\n          <div></div>\n        </div>\n      </Fragment>\n    );\n  }\n\n  return (\n    <li>\n      <div className={styles.itemWrapper}>\n        <span className={styles.line} />\n        <div className={styles.itemContentWrapper}>{content}</div>\n      </div>\n    </li>\n  );\n}\n\nfunction App() {\n  const debugData = useSyncExternalStore(\n    (update) => {\n      currentSubscriber = update;\n      return () => {\n        currentSubscriber = undefined;\n      };\n    },\n    () => currentDebugData,\n  );\n  const [workspacePath, setWorkspacePath] = useWorkspacePath();\n\n  return (\n    <div className={styles.wrapper}>\n      <div className={styles.innerWrapper}>\n        <div className={styles.workspaceWrapper}>\n          <div className={styles.workspaceInnerWrapper}>\n            <div>\n              <label className={styles.workspaceLabel}>\n                Workspace absolute path\n              </label>\n              <input\n                type=\"text\"\n                value={workspacePath}\n                onChange={(event) => setWorkspacePath(event.target.value)}\n                className={styles.workspaceInput}\n              />\n            </div>\n          </div>\n        </div>\n        <div className={styles.flowRoot}>\n          <ul className={styles.list}>\n            {debugData.map((data, index) => (\n              <Item key={index} data={data} workspacePath={workspacePath} />\n            ))}\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ndocument.head.appendChild(styles.styleTag);\n\nrender(<App />, root);\n\nexport function mount() {\n  document.body.appendChild(root);\n}\n\nexport function unmount() {\n  document.body.removeChild(root);\n}\n"]}